leaf4# show running-configuration
!
kdump enable
kdump memory 0M-2G:256M,2G-4G:320M,4G-8G:384M,8G-:448M
kdump num-dumps 3
ip prefix-list UNDERLAY seq 1 permit 10.0.0.0/24 ge 32 le 32
ip prefix-list UNDERLAY seq 10 permit 10.0.10.0/24 ge 32 le 32
ip vrf mgmt
ip vrf Vrf1
ip vrf Vrf2
ip vrf default
ip anycast-mac-address 00:00:00:00:91:87
ip anycast-address enable
ipv6 anycast-address enable
core enable
factory default profile l3 confirm
!
nat
 timeout 600
 tcp-timeout 86400
 udp-timeout 300
!
!
tam
!
qos scheduler-policy copp-scheduler-policy
 !
 queue 0
  pir 100
  type wrr
  weight 1
 !
 queue 1
  pir 100
  type wrr
  weight 1
 !
 queue 2
  pir 600
  type wrr
  weight 2
 !
 queue 3
  pir 8000
  type wrr
  weight 1
 !
 queue 4
  pir 500
  type wrr
  weight 1
 !
 queue 5
  pir 300
  type wrr
  weight 1
 !
 queue 6
  pir 2000
  type wrr
  weight 2
 !
 queue 7
  pir 6000
  type wrr
  weight 2
 !
 queue 8
  pir 1000
  type wrr
  weight 2
 !
 queue 9
  pir 300
  type wrr
  weight 2
 !
 queue 10
  pir 3000
  type wrr
  weight 2
 !
 queue 11
  pir 3000
  type wrr
  weight 2
 !
 queue 12
  pir 2000
  type wrr
  weight 2
 !
 queue 13
  pir 5000
  type wrr
  weight 2
 !
 queue 14
  pir 10000
  type wrr
  weight 6
 !
 queue 15
  pir 5000
  type wrr
  weight 4
 !
 queue 16
  pir 5000
  type wrr
  weight 4
 !
 queue 17
  pir 500
  type wrr
  weight 2
 !
 queue 18
  pir 500
  type wrr
  weight 2
 !
 queue 19
  pir 5000
  type wrr
  weight 3
 !
 queue 20
  pir 1500
  type wrr
  weight 10
 !
 queue 21
  pir 16000
  type wrr
  weight 30
 !
 queue 22
  pir 500
  type wrr
  weight 10
 !
 queue 23
  pir 500
  type wrr
  weight 10
 !
 queue 24
  pir 5000
  type wrr
  weight 3
 !
 port
!
interface Vlan100
 neigh-suppress
 ip vrf forwarding Vrf1
 ip anycast-address 192.168.100.254/24
!
interface Vlan150
 neigh-suppress
 ip vrf forwarding Vrf1
 ip anycast-address 192.168.150.254/24
!
interface Vlan199
 neigh-suppress
 ip vrf forwarding Vrf1
!
interface Vlan200
 neigh-suppress
 ip vrf forwarding Vrf2
 ip anycast-address 192.168.200.254/24
!
interface Vlan4094
 mclag-separate-ip
 ip address 10.10.10.3/31
!
interface Loopback 0
 description "Loopback Underlay"
 ip address 10.0.0.4/32
!
interface Loopback 1
 description "Loopback Underlay"
 ip address 10.0.10.2/32
!
interface PortChannel 1
 switchport trunk allowed Vlan 199,4094
 no shutdown
!
interface PortChannel 100
 switchport access Vlan 150
 no shutdown
 mclag 1
!
interface PortChannel 200
 switchport access Vlan 200
 no shutdown
 mclag 1
!
interface Management 0
 description Management0
 mtu 1500
 autoneg on
 speed 1000
!
interface Ethernet0
 description To_Spine_1
 mtu 9100
 speed 25000
 no shutdown
 ipv6 enable
!
interface Ethernet1
 description To_Spine_2
 mtu 9100
 speed 25000
 no shutdown
 ipv6 enable
!
interface Ethernet2
 description To_Server_11
 mtu 9100
 speed 25000
 channel-group 100
 no shutdown
!
interface Ethernet3
 description To_Server_21
 mtu 9100
 speed 25000
 channel-group 200
 no shutdown
!
interface Ethernet4
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet5
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet6
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet7
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet8
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet9
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet10
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet11
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet12
 mtu 9100
 speed 25000
 shutdown
 !
interface Ethernet13
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet14
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet15
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet16
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet17
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet18
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet19
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet20
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet21
 mtu 9100
 speed 25000
 shutdown
!
interface Ethernet22
 description To_MCLAG_peer
 mtu 9100
 speed 25000
 channel-group 1
 no shutdown
!
interface Ethernet23
 description To_MCLAG_peer
 mtu 9100
 speed 25000
 channel-group 1
 no shutdown
!
interface Ethernet24
 mtu 9100
 speed 100000
 shutdown
!
interface Ethernet28
 mtu 9100
 speed 100000
 shutdown
!
interface Ethernet32
 mtu 9100
 speed 100000
 shutdown
!
interface Ethernet36
 mtu 9100
 speed 100000
 shutdown
!
route-map REDISTU permit 10
 match ip address prefix-list UNDERLAY
!
router bgp 65002 vrf Vrf1
 log-neighbor-changes
 bestpath compare-routerid
 timers 60 180
 !
 address-family ipv4 unicast
  redistribute connected
  maximum-paths 1
  maximum-paths ibgp 1
  dampening
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
!
router bgp 65002 vrf Vrf2
 log-neighbor-changes
 bestpath compare-routerid
 timers 60 180
 !
 address-family ipv4 unicast
  redistribute connected
  maximum-paths 1
  maximum-paths ibgp 1
  dampening
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
!
router bgp 65002
 router-id 10.0.0.4
 log-neighbor-changes
 bestpath as-path multipath-relax
 bestpath compare-routerid
 timers 60 180
 !
 address-family ipv4 unicast
  redistribute connected route-map REDISTU
  maximum-paths 4
  maximum-paths ibgp 1
  dampening
 !
 address-family l2vpn evpn
  advertise-all-vni
 !
 peer-group SPINE
  remote-as external
  timers 3 9
  timers connect 30
  advertisement-interval 5
  bfd
  capability extended-nexthop
  !
  address-family ipv4 unicast
   activate
   allowas-in 2
   send-community both
  !
  address-family l2vpn evpn
   activate
 !
 neighbor interface Ethernet0
  peer-group SPINE
 !
 neighbor interface Ethernet1
  peer-group SPINE
!
interface vxlan vtep2
 source-ip 10.0.10.2
 map vni 100 vlan 100
 map vni 150 vlan 150
 map vni 199 vlan 199
 map vni 200 vlan 200
 map vni 199 vrf Vrf1
!
class-map class-oob-arp match-type fields match-all
 match ethertype  arp
!
class-map class-oob-dhcp-client match-type fields match-all
 match ethertype  ip
 match ip protocol udp
 match destination-port eq 68
!
class-map class-oob-dhcp-server match-type fields match-all
 match ethertype  ip
 match ip protocol udp
 match destination-port eq 67
!
class-map class-oob-ip-multicast match-type fields match-all
 match ethertype  ip
 match destination-address 224.0.0.0/4
!
class-map class-oob-ipv6-multicast match-type fields match-all
 match ethertype  0x86DD
 match destination-address ff00::/8
!
class-map copp-system-arp match-type copp
 match protocol arp_req
 match protocol arp_resp
 match protocol neigh_discovery
!
class-map copp-system-bfd match-type copp
 match protocol bfd
 match protocol bfdv6
!
class-map copp-system-bgp match-type copp
 match protocol bgp
 match protocol bgpv6
!
class-map copp-system-dhcp match-type copp
 match protocol dhcp
 match protocol dhcpv6
!
class-map copp-system-iccp match-type copp
 match protocol iccp
!
class-map copp-system-icmp match-type copp
 match protocol icmp
 match protocol icmpv6
!
class-map copp-system-igmp match-type copp
 match protocol igmp_query
!
class-map copp-system-ip2me match-type copp
 match protocol ip2me
!
class-map copp-system-lacp match-type copp
 match protocol lacp
!
class-map copp-system-lldp match-type copp
 match protocol lldp
!
class-map copp-system-mtu match-type copp
 match protocol l3_mtu_error
!
class-map copp-system-nat match-type copp
 match protocol src_nat_miss
 match protocol dest_nat_miss
!
class-map copp-system-ospf match-type copp
 match protocol ospf
!
class-map copp-system-pim match-type copp
 match protocol pim
!
class-map copp-system-ptp match-type copp
 match protocol ptp
!
class-map copp-system-sflow match-type copp
 match protocol sample_packet
!
class-map copp-system-stp match-type copp
 match protocol stp
 match protocol pvrst
!
class-map copp-system-subnet match-type copp
 match protocol subnet
!
class-map copp-system-suppress match-type copp
 match protocol arp_suppress
 match protocol nd_suppress
!
class-map copp-system-udld match-type copp
 match protocol udld
!
class-map copp-system-vrrp match-type copp
 match protocol vrrp
 match protocol vrrpv6
!
class-map default match-type any
!
copp-action copp-system-arp
 set trap-action copy
 set trap-queue 10
 set trap-priority 10
 police cir 3000 cbs 3000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-bfd
 set trap-action trap
 set trap-queue 20
 set trap-priority 20
 police cir 1500 cbs 1500
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-bgp
 set trap-action trap
 set trap-queue 14
 set trap-priority 14
 police cir 10000 cbs 10000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-dhcp
 set trap-action trap
 set trap-queue 9
 set trap-priority 9
 police cir 300 cbs 300
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-iccp
 set trap-action trap
 set trap-queue 16
 set trap-priority 16
 police cir 5000 cbs 5000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-icmp
 set trap-action trap
 set trap-queue 8
 set trap-priority 8
 police cir 1000 cbs 1000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-igmp
 set trap-action trap
 set trap-queue 12
 set trap-priority 12
 police cir 2000 cbs 2000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-ip2me
 set trap-action trap
 set trap-queue 7
 set trap-priority 7
 police cir 6000 cbs 6000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-lacp
 set trap-action trap
 set trap-queue 23
 set trap-priority 23
 police cir 500 cbs 500
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-lldp
 set trap-action trap
 set trap-queue 18
 set trap-priority 18
 police cir 500 cbs 500
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-mtu
 set trap-action trap
 set trap-queue 4
 set trap-priority 4
 police cir 500 cbs 500
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-nat
 set trap-action trap
 set trap-queue 5
 set trap-priority 5
 police cir 300 cbs 300
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-ospf
 set trap-action copy
 set trap-queue 15
 set trap-priority 15
 police cir 5000 cbs 5000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-pim
 set trap-action trap
 set trap-queue 13
 set trap-priority 13
 police cir 5000 cbs 5000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-ptp
 set trap-action trap
 set trap-queue 24
 set trap-priority 24
 police cir 5000 cbs 5000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-sflow
 set trap-action trap
 set trap-queue 3
 set trap-priority 3
 police cir 8000 cbs 8000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-stp
 set trap-action trap
 set trap-queue 21
 set trap-priority 21
 police cir 16000 cbs 16000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-subnet
 set trap-action trap
 set trap-queue 6
 set trap-priority 6
 police cir 2000 cbs 2000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-suppress
 set trap-action trap
 set trap-queue 11
 set trap-priority 11
 police cir 3000 cbs 3000
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-udld
 set trap-action trap
 set trap-queue 22
 set trap-priority 22
 police cir 500 cbs 500
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action copp-system-vrrp
 set trap-action trap
 set trap-queue 17
 set trap-priority 17
 police cir 500 cbs 500
 police meter-type pps
 police mode sr_tcm red drop
!
copp-action default
 set trap-queue 0
 police cir 100 cbs 100
 police meter-type pps
 police mode sr_tcm red drop
!
policy-map copp-system-policy type copp
 class default priority 0
  set copp-action default
 !
 class copp-system-vrrp priority 0
  set copp-action copp-system-vrrp
 !
 class copp-system-udld priority 0
  set copp-action copp-system-udld
 !
 class copp-system-suppress priority 0
  set copp-action copp-system-suppress
 !
 class copp-system-subnet priority 0
  set copp-action copp-system-subnet
 !
 class copp-system-stp priority 0
  set copp-action copp-system-stp
 !
 class copp-system-sflow priority 0
  set copp-action copp-system-sflow
 !
 class copp-system-ptp priority 0
  set copp-action copp-system-ptp
 !
 class copp-system-pim priority 0
  set copp-action copp-system-pim
 !
 class copp-system-ospf priority 0
  set copp-action copp-system-ospf
 !
 class copp-system-nat priority 0
  set copp-action copp-system-nat
 !
 class copp-system-mtu priority 0
  set copp-action copp-system-mtu
 !
 class copp-system-lldp priority 0
  set copp-action copp-system-lldp
 !
 class copp-system-lacp priority 0
  set copp-action copp-system-lacp
 !
 class copp-system-ip2me priority 0
  set copp-action copp-system-ip2me
 !
 class copp-system-igmp priority 0
  set copp-action copp-system-igmp
 !
 class copp-system-icmp priority 0
  set copp-action copp-system-icmp
 !
 class copp-system-iccp priority 0
  set copp-action copp-system-iccp
 !
 class copp-system-dhcp priority 0
  set copp-action copp-system-dhcp
 !
 class copp-system-bgp priority 0
  set copp-action copp-system-bgp
 !
 class copp-system-bfd priority 0
  set copp-action copp-system-bfd
 !
 class copp-system-arp priority 0
  set copp-action copp-system-arp
 !
!
policy-map oob-qos-policy type qos
 class class-oob-dhcp-client priority 1020
  police cir 512000
 !
 class class-oob-dhcp-server priority 1015
  police cir 512000
 !
 class class-oob-arp priority 1010
  police cir 256000
 !
 class class-oob-ipv6-multicast priority 1005
  police cir 256000
 !
 class class-oob-ip-multicast priority 1000
  police cir 256000
 !
!
mclag domain 1
 source-ip 10.10.10.3
 peer-ip 10.10.10.2
 peer-link PortChannel1
 keepalive-interval 1
 session-timeout 3
 delay-restore 300

